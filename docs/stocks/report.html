<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Investment Analyser - Stocks</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
        <link rel="stylesheet" type="text/css" href="../static/css/styles.css" />
        <style>
            #historyTable th.text-right {
                text-align: right !important;
            }

            #forecastTable th.text-right {
                text-align: right !important;
            }

            #dividendsTable th.text-right {
                text-align: right !important;
            }
        </style>
    </head>
    <body>
        <div id="loadingoverlay-placeholder"></div>

        <button id="scrollToTop" class="btn btn-custom-blue rounded-circle shadow">â†‘</button>

        <div class="container">
            <div id="userbar-placeholder"></div>

            <div class="position-relative">
                <h1 class="title">
                    <img id="logo" class="logo" />
                    <span id="companyName"></span>
                </h1>
                <div class="recommendation-box hold" id="riskProfileContainer">
                    <strong>Risk:</strong> <span id="riskProfile"></span>
                </div>
            </div>

            <div id="error-placeholder"></div>
            <div id="menu-placeholder"></div>

            <div class="row custom-breadcrumb padding" id="investmentContainer">
                <div class="col-md-4 investment-row">
                    <strong>Net Deposit:</strong> <span id="investmentNet" style="font-weight: bold;"></span>
                </div>
                <div class="col-md-4 investment-row">
                    <strong>Current Value:</strong> <span id="investmentCurrent" style="font-weight: bold;"></span>
                </div>
                <div class="col-md-4 investment-row">
                    <strong>Rate of Return %:</strong> <span id="investmentGrowth" style="font-weight: bold;"></span>
                </div>
            </div>

            <div class="row" style="padding-bottom: 10px; padding-top: 10px; display: flex; align-items: stretch;">
                <div class="col-md-6 d-flex">
                    <div class="recommendation-box hold" id="shortTermRecommendationContainer" style="flex: 1;">
                        <strong>Short-Term:</strong> <span id="shortTermRecommendation"></span>
                    </div>
                </div>
                <div class="col-md-6 d-flex">
                    <div class="recommendation-box hold" id="longTermRecommendationContainer" style="flex: 1;">
                        <strong>Long-Term:</strong> <span id="longTermRecommendation"></span>
                    </div>
                </div>
            </div>

            <h2 class="title">Company Information</h2>
            <div class="row">
                <div class="col-md-6">
                    <ul class="details-list">
                        <li><strong>Exchange:</strong> <span id="exchange"></span></li>
                        <li><strong>Industry:</strong> <span id="industry"></span></li>
                        <li><strong>Sector:</strong> <span id="sector"></span></li>
                        <li><strong>Website:</strong> <a target="_blank" id="website"></a></li>
                        <li><strong>Stocks Owned:</strong> <span id="stocksOwned"></span></li>
                        <li><strong>Avg. Price:</strong> <span id="avgPrice"></span></li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <ul class="details-list">
                        <li><strong>Market Cap:</strong> <span id="marketCap"></span></li>
                        <li><strong>Dividend Yield:</strong> <span id="dividendYield"></span></li>
                        <li><strong>Dividend Payout Ratio:</strong> <span id="dividendPayoutRatio"></span></li>
                        <li><strong>Dividend Frequency:</strong> <span id="dividendFrequency"></span></li>
                        <li><strong>Volatility:</strong> <span id="volatility"></span></li>
                        <li><strong>Beta:</strong> <span id="beta"></span></li>
                    </ul>
                </div>
            </div>

            <h2 class="title">Historical Performance</h2>
            <table id="historyTable" class="display dataTable">
                <thead>
                    <tr>
                        <th>Index</th>
                        <th>Period</th>
                        <th class="text-right">Growth %</th>
                        <th class="text-right">CAGR %</th>
                        <th class="text-right">Dividend CAGR %</th>
                        <th class="text-right">Total Return CAGR %</th>
                    </tr>
                </thead>
            </table>

            <div class="plotly-chart">
                <div id="stockInfoChart" style="display: flex; justify-content: center; align-items: center; height: 100%; text-align: center;"></div>
            </div>

            <h2 class="title">Future Performance</h2>
            <table id="forecastTable" class="display dataTable">
                <thead>
                    <tr>
                        <th>Index</th>
                        <th>Period</th>
                        <th class="text-right">Forecast Price</th>
                        <th class="text-right">Growth %</th>
                        <th class="text-right">CAGR %</th>
                        <th class="text-right">Dividend CAGR %</th>
                        <th class="text-right">Total Returns CAGR %</th>
                        <th class="text-right">Price Return %</th>
                        <th class="text-right">Total Returns</th>
                    </tr>
                </thead>
            </table>

            <h2 class="title">Dividends</h2>
            <table id="dividendsTable" class="display dataTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th class="text-right">Amount <i>(per share)</i></th>
                        <th class="text-right">Earnings</th>
                    </tr>
                </thead>
            </table>
        </div>

        <div id="keyterminology-placeholder"></div>

        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
        <script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
        <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/responsive/2.3.0/js/dataTables.responsive.min.js"></script>
        <script src="https://cdn.plot.ly/plotly-3.0.1.min.js" charset="utf-8"></script>
        <script src="../static/js/utils.js"></script>
        <script src="../static/js/auth0.js"></script>
        <script src="../static/js/currency.js"></script>
        <script src="../static/js/exchange.js"></script>
        <script>
            $(async function() {
                $('#loadingoverlay-placeholder').load('../public/loadingoverlay.html', async function() {
                    $('#loadingOverlayMessage').text('Your awesome "Stock Analysis" report is loading. Hang tight! If it takes too long, just refresh the page...');
                });
                $('#error-placeholder').load('../public/error.html', async function() {
                    await loadError();
                });
                $('#menu-placeholder').load('../public/menu.html');
                $('#userbar-placeholder').load('../public/userbar.html', async function() {
                    await getDefaultCurrency();
                    await verifyAuth0Authentication();
                    await initLogoutButton();
                });
                $('#keyterminology-placeholder').load('../public/stocks/keyterminology.html');
                
                await initPage();
            });

            async function initPage() {
                let defaultCurrency, exchanges, stockData, fxRate, fxRateKey, stockObject;

                const $loadingOverlay = $('#loading-overlay');
                const urlParams = new URLSearchParams(window.location.search);
                const errorRedirectionUrl = `/investment-analyser/stocks/input.html?${decodeURIComponent(urlParams.toString())}`;
                const ticker = urlParams.get('ticker');
                const stocksOwned = parseFloat(urlParams.get('stocksOwned')) || null;
                const avgPrice = parseFloat(urlParams.get('avgPrice')) || null;

                if (!ticker) return $.Error.displayError('Missing Stock Ticker.', true, errorRedirectionUrl);
                if (!defaultCurrency) {
                    defaultCurrency = $.Currency.getDefaultCurrency();
                }
                if (!defaultCurrency) return $.Error.displayError('Unable to retrieve the default currency.', true, errorRedirectionUrl);
                if (!exchanges) {
                    exchanges = $.Exchange.getExchanges();
                }
                if (!exchanges) console.warn('Unable to retrieve the exchanges mapping.');
            }
        </script>
    </body>
</html>